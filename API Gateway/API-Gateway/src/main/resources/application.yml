server:
  port: 8080

spring:
  application:
    name: api-gateway
  cloud:
    gateway:
      routes:
       
        - id: notification-websocket
          uri: http://notification-service:8080
          predicates:
            - Path=/ws/notifications/**
        
       
        - id: auth-service
          uri: http://auth-service:8080
          predicates:
            - Path=/auth/**
          filters:
            - RewritePath=/auth/?(?<segment>.*), /api/v1/auth/$\{segment}
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 10
                redis-rate-limiter.burstCapacity: 20
                redis-rate-limiter.requestedTokens: 1
            - name: Retry
              args:
                retries: 3
                statuses: BAD_GATEWAY,GATEWAY_TIMEOUT
                methods: GET,POST
                backoff:
                  firstBackoff: 50ms
                  maxBackoff: 500ms
                  factor: 2
                  basedOnPreviousValue: false
          
        
        - id: user-service
          uri: http://user-service:8080
          predicates:
            - Path=/users/**
          filters:
            - RewritePath=/users/?(?<segment>.*), /api/v1/users/$\{segment}
        
        - id: team-service
          uri: http://team-service:8080
          predicates:
            - Path=/teams/**
          filters:
            - RewritePath=/teams/?(?<segment>.*), /api/v1/teams/$\{segment}
        
        - id: channel-service
          uri: http://channel-service:8080
          predicates:
            - Path=/channels/**
          filters:
            - RewritePath=/channels/?(?<segment>.*), /api/v1/channels/$\{segment}
        
        
        - id: chat-service
          uri: http://chat-service:8080
          predicates:
            - Path=/chat/**
          filters:
            - RewritePath=/chat/?(?<segment>.*), /api/v1/chat/$\{segment}
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 30
                redis-rate-limiter.burstCapacity: 60
                redis-rate-limiter.requestedTokens: 1
        
        
        - id: meeting-service
          uri: http://meeting-service:8080
          predicates:
            - Path=/meetings/**
          filters:
            - RewritePath=/meetings/?(?<segment>.*), /api/v1/meetings/$\{segment}
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 20
                redis-rate-limiter.burstCapacity: 40
                redis-rate-limiter.requestedTokens: 1
        
    
        - id: file-service
          uri: http://file-service:8080
          predicates:
            - Path=/files/**
          filters:
            - RewritePath=/files/?(?<segment>.*), /api/v1/files/$\{segment}
        
       
        - id: notification-service
          uri: http://notification-service:8080
          predicates:
            - Path=/notifications/**
          filters:
            - RewritePath=/notifications/?(?<segment>.*), /api/v1/notifications/$\{segment}
        
        
        - id: task-service
          uri: http://task-service:8080
          predicates:
            - Path=/tasks/**
          filters:
            - RewritePath=/tasks/?(?<segment>.*), /api/tasks/$\{segment}


jwt:
  secret: ${JWT_SECRET:DevBlockerSecretKeyForJWTTokenGeneration123456789012345678901234567890}
  expiration: ${JWT_EXPIRATION:86400000}

rate-limit:
  requests-per-minute: ${RATE_LIMIT_REQUESTS_PER_MINUTE:100}
  enabled: true


management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when-authorized
  prometheus:
    metrics:
      export:
        enabled: true

logging:
  level:
    root: ${LOG_LEVEL:INFO}
    org.springframework.cloud.gateway: ${LOG_LEVEL:INFO}
    com.connect.API.Gateway: ${LOG_LEVEL:INFO}
    reactor.netty: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level [%X{traceId:-},%X{spanId:-}] %logger{36} - %msg%n"

